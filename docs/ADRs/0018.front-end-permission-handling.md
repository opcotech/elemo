# Front-end Permission Handling

| author       | created at | updated at | status   |
|:-------------|:-----------|------------|:---------|
| @gabor-boros | 2025-08-10 | -          | accepted |

## Abstract

The backend provides a flexible permissions system and exposes the results of
permission checks to the frontend. We need a frontend solution that can use
these evaluated permissions to determine whether specific components should be
rendered.

## Decision

We will leverage the `/v1/permissions/resources/$resourceId` endpoint on the
frontend to retrieve the user's permissions for a given resource.

To make working with permissions easier, we are introducing the following
functions/components:

* **`usePermissions(resourceId, [hasSSRPermissions])` hook** – returns the
   permissions for the specified resource if the `hasSSRPermissions` argument
   if evaluated to false. This way, the CSR permission checking is prevented
   when the permissions are already available.
* **`can()` helper function** – checks whether the retrieved permissions
   include the required permission type.

Additionally, the `loader` method of a page can be used to pre-fetch data.

An example page with SSR-first (then CSR fallback in case of page refresh):

```ts
import { createFileRoute, useLoaderData } from "@tanstack/react-router";

import { usePermissions } from "@/hooks/use-permissions";
import { v1PermissionResourceGet } from "@/lib/api";
import { can } from "@/lib/auth/permissions";
import { requireAuthBeforeLoad } from "@/lib/auth/require-auth";
import { runSsrLoader } from "@/lib/auth/ssr-loader";

export const Route = createFileRoute("/permissions-demo/")({
  beforeLoad: requireAuthBeforeLoad,
  component: Page,
  loader: async ({ context }) => {
    const resourceId = "Todo:d2calfl1a6es73amlg0g";

    const permissions = await runSsrLoader({
      context,
      request: async () => v1PermissionResourceGet({
        path: {
          resourceId,
        },
      }),
    });

    return { resourceId, permissions: permissions.data };
  },
});

function Page() {
  const { resourceId, permissions: ssrPermissions } = useLoaderData({ from: Route.id });
  const { data: csrPermissions, isLoading } = usePermissions(
    resourceId,
    Boolean(ssrPermissions)
  );
  const permissions = ssrPermissions || csrPermissions;

  return (
   <div>
      {isLoading ? (
         <div>Loading...</div>
      ) : (
         <>
         {can(permissions, "*") ? (
            <div>✅ permissions</div>
         ) : (
            <div>❌ permissions</div>
         )}
         </>
      )}
   </div>
  );
}
```

## Consequences

This approach provides an efficient way for the frontend to access the user's
permissions and conditionally render components.

## References

None.
